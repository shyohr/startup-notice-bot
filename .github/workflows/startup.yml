name: Startup Notice Bot

on:
  schedule:
    - cron: '0 0 * * *'   # ë§¤ì¼ ì˜¤ì „ 9ì‹œ (KST)
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch startup notices
        run: |
          WEBHOOK_URL="https://discord.com/api/webhooks/1458104438039511138/GyqLr_wYx5RZzyouJELZNoj8kIDgGgNQ8EwxcxSXmRQtwmemQKYdSdqk8ERcwJZYTTbh"

          PAGE=$(curl -L -A "Mozilla/5.0" https://www.k-startup.go.kr/web/contents/bizpbanc-ongoing.do)

          KEYWORDS="ë„ì•½|íŒ¨í‚¤ì§€|ì˜ˆë¹„|ì´ˆê¸°|ì²­ë…„|ì‚¬ê´€í•™êµ"

          MATCHES=$(echo "$PAGE" | grep -E "$KEYWORDS" | grep "ëª¨ì§‘" | head -n 5)

          if [ -z "$MATCHES" ]; then
            MESSAGE="ğŸ“¢ ì˜¤ëŠ˜ ê¸°ì¤€ ëª¨ì§‘ì¤‘ì¸ í•µì‹¬ ì°½ì—…Â·ì˜ˆë¹„ì°½ì—… ê³µê³  ìš”ì•½\n\nâš ï¸ í‚¤ì›Œë“œ ê¸°ì¤€ìœ¼ë¡œ í™•ì¸ëœ ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤."
          else
            MESSAGE="ğŸ“¢ ì˜¤ëŠ˜ ê¸°ì¤€ ëª¨ì§‘ì¤‘ì¸ í•µì‹¬ ì°½ì—…Â·ì˜ˆë¹„ì°½ì—… ê³µê³  ìš”ì•½\n\n$(echo "$MATCHES" | sed 's/<[^>]*>//g')"
          fi

          curl -X POST "$WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -d "{\"content\":\"$MESSAGE\"}"
